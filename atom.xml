<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Liam Kaufman]]></title>
  <link href="http://liamkaufman.com/atom.xml" rel="self"/>
  <link href="http://liamkaufman.com/"/>
  <updated>2012-02-11T16:27:53-05:00</updated>
  <id>http://liamkaufman.com/</id>
  <author>
    <name><![CDATA[Liam Kaufman]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Pushing Files to the Browser Using Delivery.js, Socket.IO and Node.js]]></title>
    <link href="http://liamkaufman.com/blog/2012/02/11/12-pushing-files-to-the-browser-using-deliveryjs-socketio-and-nodejs/"/>
    <updated>2012-02-11T00:00:00-05:00</updated>
    <id>http://liamkaufman.com/blog/2012/02/11/12-pushing-files-to-the-browser-using-deliveryjs-socketio-and-nodejs</id>
    <content type="html"><![CDATA[<p>
Recently I&#8217;ve been working with both the HTML 5 File API and Socket.IO and it occured to me that those technologies could be used to send, and push, files between the client and server. Immediately I set about making delivery.js, a simple node module that makes it extremely easy to send and push files between the client and the server via Socket.IO. 
</p>
<p>
I should note that this is my first node module, so constructive critism and feedback are welcome and encouraged! 
</p>

<h2> Example:  Pushing An Image To The Client</h2>
<p>
<a class="github" href="https://github.com/liamks/Delivery.js"><span></span>Delivery.js on Github</a>
</p>
<p>
In the following example, once a client connects to the server an image will be pushed to the client. When the client receives the image, the image&#8217;s data URL (&#8220;data:image/gif;base64,R0lGODlhEAAOALMAAOazT&#8230;&#8221;) is assigned to the src attribute of an img element.
</p>

<figure class='code'><figcaption><span>Client</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;http://0.0.0.0:5001&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">delivery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Delivery</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">delivery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;receive.start&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">fileUID</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;receiving a file!&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">delivery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;receive.success&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">){</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">isImage</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">dataURL</span><span class="p">());</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

<figure class='code'><figcaption><span>Server</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">io</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5001</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">dl</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;delivery&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">delivery</span> <span class="o">=</span> <span class="nx">dl</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">delivery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;delivery.connect&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">delivery</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">delivery</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;sample-image.jpg&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">path</span> <span class="o">:</span> <span class="s1">&#39;./sample-image.jpg&#39;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">delivery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;send.success&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;File successfully sent to client!&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

<h2> Advantages </h2>

<p>
While delivery.js is more of an experiment, there could be some advantages to using Web Sockets to transfer files. Once a Web Socket connection is established  messages (frames) sent between the client and server contain only 2 additional bytes of overhead. In contrast, a traditional POST request, and response, may have headers totaling <a href="http://websocket.org/quantum.html">871 bytes</a>. This could be a significant addition if many files are being sent, and would be even more significant if files are being divided into batches before being sent to the server. When pushing files to the client, the overhead of traditional polling methods provides an even starker contrast to Web Sockets.
</p>

<h2> Disadvantages </h2>

<p>
The most apparent disadvantage would be the fact that it bipasses traditional caching methods. Instead of caching based on a file&#8217;s URL, caching would be based on the content of the Web Socket&#8217;s message. One possibility would be to cache a base64, or text, version of the file within Redis for fast, in memory, access. 
</p>

<h2> Future </h2>
<p>
With <a href="http://gildas-lormeau.github.com/zip.js/">zip.js</a> files could be deflated, or inflated, within the browser. In-browser file zipping could have a positive impact on transfer speeds. To check the integrity of the unzipped file an md5 checksum could be generated client-side, using Paul Johnston&#8217;s <a href="http://pajhome.org.uk/crypt/md5/">JavaScript MD5</a> implementation, and then passed along with the zipped file.
</p>

<p>
For more documentation and examples see Delivery.js on Github:<br />
<a class="github" href="https://github.com/liamks/Delivery.js"><span></span>Delivery.js on Github</a>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Testing Socket.IO with Mocha, Should.js and Socket.IO Client]]></title>
    <link href="http://liamkaufman.com/blog/2012/01/28/testing-socketio-with-mocha-should-and-socketio-client/"/>
    <updated>2012-01-28T00:00:00-05:00</updated>
    <id>http://liamkaufman.com/blog/2012/01/28/testing-socketio-with-mocha-should-and-socketio-client</id>
    <content type="html"><![CDATA[<p>
I’m currently in the midst of creating an application that utilizes <a href="http://socket.io/">Socket.IO</a> for real-time communication between users. Using  <a href="http://visionmedia.github.com/mocha/">mocha</a> and <a href="https://github.com/visionmedia/should.js">should.js</a> I was able to test objects within my node app. However, I quickly found that there were some odd synchronization issues between clients that the test cases couldn&#8217;t cover. To test the interaction between clients I needed a way to programatically communicate to my node server: Enter <a href="https://github.com/LearnBoost/socket.io-client">socket.io-client</a>.
</p>
<p>
<a class="github" href="https://github.com/liamks/Testing-Socket.IO"><span></span>Testing Socket.IO on Github</a>
</p>
<h2>
  Writing Tests For your Socket.io Application
</h2>
<p>
As an example of how to test your socket.io application we’ll create a small chat application and test it using: <a href="https://github.com/LearnBoost/socket.io-client">socket.io-client</a>, <a href="http://visionmedia.github.com/mocha/">mocha</a> and <a href="https://github.com/visionmedia/should.js">should.js</a>.
</p>
<p>
Our chat server should be able to:
</p>
<ol class='ordered-list'>
  <li>broadcast that a new user has joined</li>
  <li>broadcast messages to the whole group</li>
  <li>handle private messages between clients</li>
</ol>
<p> 
If you hit any roadblocks see <a href="#trouble-shooting">Trouble shooting</a> at the bottom of this post.
</p>
<p>
Without further ado, below is the bare essentials for our socket.IO chat server (chat-server.js) and our tests (tests/test-chat-server.js).
</p>
<figure class='code'><figcaption><span>Server V0.1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

<figure class='code'><figcaption><span>Tests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">should</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;should&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io-client&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">socketURL</span> <span class="o">=</span> <span class="s1">&#39;http://0.0.0.0:5000&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span><span class="p">{</span>
</span><span class='line'>  <span class="nx">transports</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;websocket&#39;</span><span class="p">],</span>
</span><span class='line'>  <span class="s1">&#39;force new connection&#39;</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">chatUser1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;Tom&#39;</span><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">chatUser2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;Sally&#39;</span><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">chatUser3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="s1">&#39;Dana&#39;</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Chat Server&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<h3>First Test</h3>
<p>
Within the describe function (line 16 in tests) we will add our first test that determines if our chat server notifies all users that a new user has joined. It&#8217;s important to disconnect both clients once this test is over, otherwise the second test will trigger this test&#8217;s &#8216;new user&#8217; event.
</p>

<figure class='code'><figcaption><span>Test 1 - One user connects, both users should be notified.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Should broadcast new user to all users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">client1</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">client1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">client1</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span> <span class="nx">chatUser1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Since first client is connected, we connect</span>
</span><span class='line'><span class="cm">    the second client. */</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">client2</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">client2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">client2</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span> <span class="nx">chatUser2</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">client2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;new user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">usersName</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">usersName</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">chatUser2</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; has joined.&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">client2</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">numUsers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">client1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;new user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">usersName</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">numUsers</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">numUsers</span> <span class="o">===</span> <span class="mi">2</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">usersName</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">chatUser2</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; has joined.&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">client1</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<p>
Now that our first test is complete, let&#8217;s run the server.
</p>
<figure class='code'><figcaption><span>Run the server</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>node chat-server.js
</span></code></pre></td></tr></table></div></figure>
<p>
In another terminal window we can run the tests.
</p>
<figure class='code'><figcaption><span>Run the tests </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mocha -R spec
</span></code></pre></td></tr></table></div></figure>
<p>
And both tests will fail (times out to be specific)! To pass the tests we simply update the chat-server.js to the following:
</p>
<figure class='code'><figcaption><span>Server V0.2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;new user&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; has joined.&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<p>
When you run the tests again they should both pass. 
</p>

<h3>Second Test</h3>
<p>
Now, we&#8217;ll add the second test that determines if a message sent from one client is sent to all the clients connected to the chat server. It may not initially be obvious why I&#8217;m using 3 clients, but it should be in the 3rd test. To determine if all 3 clients have received a message we keep a counter (messges) and check that each received message is the correct message.
</p>
<figure class='code'><figcaption><span>Test 2 - User sends a message to chat room</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Should be able to broadcast messages&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">client1</span><span class="p">,</span> <span class="nx">client2</span><span class="p">,</span> <span class="nx">client3</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">checkMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">client</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">message</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">client</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">messages</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">messages</span> <span class="o">===</span> <span class="mi">3</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">client1</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">checkMessage</span><span class="p">(</span><span class="nx">client1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">client1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">client2</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">checkMessage</span><span class="p">(</span><span class="nx">client2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">client2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">client3</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">checkMessage</span><span class="p">(</span><span class="nx">client3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">client3</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">client2</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<p>
If you run the tests again it should fail! We can fix this by updating the server code to look like:
</p>
<figure class='code'><figcaption><span>Server V0.3</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;new user&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; has joined.&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<h3>Third Test</h3>
<p>With the first two bits of functionality complete, and tested, we now need to test that 1) a client can send a private message to another client and 2) no other clients receive that message. At minimum we need 3 clients to test this condition. Once all 3 clients have connected, the 3rd client will send a private message to the first client. It&#8217;s easy to test that the first client has received the message, but how do we test that the 2nd client has not? The solution I&#8217;m using below is that the test simply waits 40 milliseconds and if only 1 message has been received, there&#8217;s a strong chance that client 2 has not received a message. I&#8217;m not sure how to write the test to be 100% sure that the client has not received the message - any thoughts?
</p>

<figure class='code'><figcaption><span>Test 3 - User sends a private message to another user.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Should be able to send private messages&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">client1</span><span class="p">,</span> <span class="nx">client2</span><span class="p">,</span> <span class="nx">client3</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span><span class="nx">to</span><span class="o">:</span> <span class="nx">chatUser1</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">txt</span><span class="o">:</span><span class="s1">&#39;Private Hello World&#39;</span><span class="p">};</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">completeTest</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">messages</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">client1</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">client2</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">client3</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">done</span><span class="p">();</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">checkPrivateMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">client</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;private message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">message</span><span class="p">.</span><span class="nx">txt</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">txt</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">msg</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">chatUser3</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">messages</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">client</span> <span class="o">===</span> <span class="nx">client1</span><span class="p">){</span>
</span><span class='line'>        <span class="cm">/* The first client has received the message</span>
</span><span class='line'><span class="cm">        we give some time to ensure that the others</span>
</span><span class='line'><span class="cm">        will not receive the same message. */</span>
</span><span class='line'>        <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">completeTest</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">client1</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">checkPrivateMessage</span><span class="p">(</span><span class="nx">client1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">client1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">client1</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span> <span class="nx">chatUser1</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">client2</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">checkPrivateMessage</span><span class="p">(</span><span class="nx">client2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">client2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">client2</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span> <span class="nx">chatUser2</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">client3</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">socketURL</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">checkPrivateMessage</span><span class="p">(</span><span class="nx">client3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">client3</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">client3</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span> <span class="nx">chatUser3</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">client3</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;private message&#39;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<p>
Once again, running the tests should fail. Lets add code to enable private messages. Ideally we&#8217;d use Redis Pub/Sub to simplify message passing, but for the sake of brevity we&#8217;ll omit it here. We&#8217;ll keep track of clients and their sockets using the clients hash. The hashe&#8217;s key will be the client&#8217;s name, and the value will be the client&#8217;s socket. When the client disconnects we delete that entry from the hash.
</p>
<figure class='code'><figcaption><span>Server V0.4</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">clients</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">userName</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection name&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">userName</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">clients</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">socket</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;new user&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; has joined.&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;private message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">fromMsg</span> <span class="o">=</span> <span class="p">{</span><span class="nx">from</span><span class="o">:</span><span class="nx">userName</span><span class="p">,</span> <span class="nx">txt</span><span class="o">:</span><span class="nx">msg</span><span class="p">.</span><span class="nx">txt</span><span class="p">}</span>
</span><span class='line'>    <span class="nx">clients</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">to</span><span class="p">].</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;private message&#39;</span><span class="p">,</span> <span class="nx">fromMsg</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">delete</span> <span class="nx">clients</span><span class="p">[</span><span class="nx">userName</span><span class="p">];</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>
<p>
Congratulations, you have a node.js chat server and you&#8217;ve tested it!
</p>
<p>
<a class="github" href="https://github.com/liamks/Testing-Socket.IO"><span></span>Testing Socket.IO on Github</a>
</p>
<h3 id="trouble-shooting">
Trouble Shooting
</h3>
<p>
<ul class='unordered-list'>
  <li>Have you installed node.io-client, mocha and should?</li>
  <li>Did you install any of the modules locally, but in another folder? If so try doing a global install.</li>
  <li>Make sure you restart the server before each test run.</li>
  <li>Running <code>mocha -R spec</code> will not work within the test folder, this command looks for the test folder, so <code>cd ..</code> if you&#8217;re in the test folder.</li>
  <li>The version of socket.io-client that was in the npm repositories at the time of writing this <a href="https://github.com/LearnBoost/socket.io-client/issues/372">would not connect to the node server</a>. To get the latest version I ran: <code>npm install https://github.com/LearnBoost/socket.io-client/zipball/master</code></li>
</ul>
</p>
<h3>Updates</h3>
<p>Using coffeescript <a href="https://twitter.com/jamescarr">@jamescarr</a> refactored the above code so the server starts automatically during testing: <a href="https://github.com/jamescarr/socket.io-test">socket.io-test</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Examples I Want to See in JavaScript Frameworks.]]></title>
    <link href="http://liamkaufman.com/blog/2011/12/13/examples_i_want_to_see_in_javascript_frameworks/"/>
    <updated>2011-12-13T00:00:00-05:00</updated>
    <id>http://liamkaufman.com/blog/2011/12/13/examples_i_want_to_see_in_javascript_frameworks</id>
    <content type="html"><![CDATA[<p>
  With the public release of <a href="http://emberjs.com">ember.js</a>,
  I excitedly poured over the examples hoping to find a framework that 
  would make Creating, Reading, Updating and Deleting (CRUD) easier. When
  push comes to shove, the vast majority of apps that I&#8217;ve worked on
  involve CRUD. 
</p>

<p>
  I want to see the following (excuse the pseudo code):<br />
<figure class='code'><figcaption><span>Model</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">model</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">validation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){...}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

<figure class='code'><figcaption><span>Controller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">controller</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){...},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){...},</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">new</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){...},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){...},</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

<figure class='code'><figcaption><span>Form</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&#39;&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span> <span class="na">name=</span><span class="s">&#39;firstName&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;submit&#39;</span> <span class="na">value=</span><span class="s">&#39;submit&#39;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>
</p>

<p>
  Will your framework help me 1) write less code, 2) get things done
  faster and 3) with less errors? Show me.
</p>
<p>
  PS: I don&#8217;t want to diminish the tremendous effort it takes to create
  a framework and release it, but please go the extra mile and provide
  some concrete CRUD examples for a single class!
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What is the best way of Mastering JavaScript?]]></title>
    <link href="http://liamkaufman.com/blog/2011/09/09/what-is-the-best-way-of-mastering-javascript/"/>
    <updated>2011-09-09T00:00:00-04:00</updated>
    <id>http://liamkaufman.com/blog/2011/09/09/what-is-the-best-way-of-mastering-javascript</id>
    <content type="html"><![CDATA[<p>
I want to master JavaScript. Before humbly doing so, I think it’s important to define what I think mastering JS consists of. In my opinion there are two parts to mastering a programming language. The first is mastering the language itself: syntax, important functions, classes, idioms, etc. The second part is mastering the programming paradigm, or paradigms, that the language falls in. This second part is difficult with JS, as it is <a href="http://en.wikipedia.org/wiki/JavaScript">object oriented, functional and imperative </a>. Thus, to master JS I must master both parts: 1) the language and 2) the paradigms.
</p>

<p>
Before explaining how I’m going to accomplish this goal, it’s worth while for me to briefly explain why I want to. I have been programming for 4 years and I just recently finished a computer science degree. In school I completed assignments where I learned elements from the 3 major programming paradigms that JS falls into. Likewise, I spent the last year using JS, but I have not delved deeper into it. Since I have scratched the surface I have realized that I enjoy creating web applications, but I eagerly want to be better at it.
</p>

<p>
Becoming a master will no doubt take years of effort, and countless hours, however I think the first four months will be critical - they will provide the foundation to build my knowledge upon. In the next four months I hope to accomplish the following (roughly in order):
</p>
<ol>
	<li>Read <em>JavaScript: The Good Parts</em>, by Douglas Crockford. (I’ve started this part)</li>
	<li>Examine jQuery’s source code.</li>
	<li>Contribute to jQuery, most likely a bug fix.</li>
	<li>Read <em>JavaScript Web Applications</em>, by Alex MacCaw.</li>
	<li>Examine Backbone.js’s source code .</li>
	<li>Contribute to Backbone.js</li>
</ol>

<p>
While completing those six goals I plan on weaving what I’ve learning into projects that I’ll be undertaking in the next four months. My hope is that by reading books, and other people’s code, I’ll learn how to write better code and engineer larger JS applications. Furthermore, by actually working on projects I’ll reinforce what I’ve learned and I’ll have something tangible to show.
</p>

<p>
Is this the best way of accomplishing my goal of mastering JS? Discuss on <a href="http://news.ycombinator.com/item?id=2979582">Hacker News.</a>
</p>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Liamkaufman.com gets a new look]]></title>
    <link href="http://liamkaufman.com/blog/2011/08/23/liamkaufmancom-gets-a-new-look/"/>
    <updated>2011-08-23T00:00:00-04:00</updated>
    <id>http://liamkaufman.com/blog/2011/08/23/liamkaufmancom-gets-a-new-look</id>
    <content type="html"><![CDATA[<p>
After 3 years without change, I&#8217;ve redone my personal website using Jekyll and Bootstrap. The previous version of liamkaufman.com was hosted on Google App Engine and consisted of a very basic CMS that I made before I knew what I was doing. I was both unhappy with the look of the site, and the code behind it. At the same time I was interested in using Jekyll, as I wanted to avoid the hassles associated with database backed sites. I also appreciate the fact that my site, and it’s content are easy to deploy and update via Github. 
</p>
<p>
Overall the process of learning Jekyll and Bootstrap was much easier than anticipated. To learn Jekyll I examined the <a href="https://github.com/schacon/schacon.github.com">source code</a> behind <a href="http://schacon.github.com/">Scott Chacon’s blog</a>. Learning Bootstrap consisted of referencing CSS classes in my DOM and referencing the Bootstrap CSS file itself: not much to it.
</p>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pyItunes, a Python iTunes Library Parser]]></title>
    <link href="http://liamkaufman.com/blog/2009/03/18/pyItunes-a-python-itunes-library-parser/"/>
    <updated>2009-03-18T00:00:00-04:00</updated>
    <id>http://liamkaufman.com/blog/2009/03/18/pyItunes-a-python-itunes-library-parser</id>
    <content type="html"><![CDATA[<p>
	In an effort to add some personality to this site I thought I&#8217;d list my favourite songs. iTunes provides
	a mechanism for users to rate songs, by giving a song 0 to 5 stars. After years of listening to music, and rating it,
	I have a large collection of rated songs. Manually copying and pasting each song into an HTML file seemed
	 inefficient and time consuming, enter Python.
</p>

<p>
	In an effort to learn Python, and parse my iTunes library, I created pyItunes, a Python module. pyItunes includes three classes that can parse the &#8220;iTunes Music Library.xml&#8221; file and convert it into list of Song objects. I decided to roll my own micro-xml parser that can only parse the iTunes xml file. Although, reinventing the wheel, especially an XML parser, is likely a horrible idea I felt it would be a good learning experience. In future versions I may swap an existing XML parser that is much faster and more efficient than the one I created.
</p>

<p>
	<h4>Download pyItunes</h4>
	<script src="http://gist.github.com/80911.js"></script>
</p>

<p>
	<h4>pyItunes Usage</h4>
	<script src="http://gist.github.com/79668.js"></script>

</p>]]></content>
  </entry>
  
</feed>
