
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Adding Real-Time To Rails With Socket.IO, Node.js and Backbone.js (With Demo) - Liam Kaufman</title>
  <meta name="author" content="Liam Kaufman">

  
  <meta name="description" content="Despite the recent distaste for Rails, I still think its a nice framework for developing websites (e.g. devise &amp; active record). However, if you &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/liamkaufman/uHFr" rel="alternate" title="Liam Kaufman" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1004776-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
 
  <h1><a href="/">Liam Kaufman</a></h1>
  
    <h2>Software Developer and Entrepreneur</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/liamkaufman/uHFr" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:liamkaufman.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about.html">About</a></li>
  <li><a href="/projects.html">Projects</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Adding Real-Time to Rails With Socket.IO, Node.js and Backbone.js (With Demo)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-25T00:00:00-05:00" pubdate data-updated="true">Feb 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>
  <a href="http://node-chatty.herokuapp.com/chatty" target="_blank"><img src="/images/chatty-screen.png"></a>
</p>
<p>
  Despite the <a href="http://gilesbowkett.blogspot.in/2012/02/rails-went-off-rails-why-im-rebuilding.html">recent distaste for Rails</a>, I still think its a nice framework for developing websites (e.g. devise &amp; active record). However, if you want real-time communication Socket.IO and Node.js seem to be the best options. If you already have an existing Rails application porting the entire application to Node.js is likely not on option. Fortunately, it is relatively easy to use Rails to serve your client-side Socket.IO web application, while Node.js and Socket.IO are used for real-time communication. The primary goal of this article is to show one method of integrating a real-time application, that is slightly more complex than a todo app, with Rails. Thus, I created Chatty, a simple chat room web application that allows a user to see all the messages in the chat room, or filter the messages by user. <a href="http://twitter.github.com/bootstrap/index.html">Twitter&#8217;s Bootstrap</a> was used for the CSS and modal dialogue. 
</p>
<p>
<a class="github" href="https://github.com/liamks/Chatty"><span></span>Code on Github</a>
</p>
<p>
  Rather than explain the code step-by-step, I&#8217;ll provide a high level overview of:
  <ul>
    <li>File organization</li>
    <li>JavaScript Templates and EJS</li>
    <li>Application Archicture and Publish/Subscribe</li>
    <li>Module Architecture</li>
    <li>Deploying to Heroku</li>
  </ul> 
<p>

<h2>File Organization</h2>
<p>
  The entire client-side Backbone.js application is within <code>app/assets/javascripts</code>. Using a JavaScript manifest file (<code>backboneApp.js</code>) all of the application&#8217;s JavaScript files are specified.
</p>

<figure class='code'><figcaption><span>Manifest file (app/assets/javasripts/bacboneApp.js)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>//= require jquery
</span><span class='line'>//= require bootstrap
</span><span class='line'>//= require underscore
</span><span class='line'>//= require backbone
</span><span class='line'>//= require socket.io
</span><span class='line'>//= require app
</span></code></pre></td></tr></table></div></figure>
<p>
  The Backbone application is within the <code>app</code> folder, which also has a manifest file. The manifest files describe all the JavaScript files that comprise the application. Within the application&#8217;s html file only a single line of code is needed to include the manifest file: <code>=javascript_include_tag "backboneApp"</code> (haml for templating). The actual organization of the files is as follows:
</p>

<figure class='code'><figcaption><span>app/assets</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>javascripts
</span><span class='line'>├── app
</span><span class='line'>│   ├── index.js
</span><span class='line'>│   ├── launch.js.coffee
</span><span class='line'>│   ├── main.js.coffee
</span><span class='line'>│   ├── modules
</span><span class='line'>│   │   ├── index.js
</span><span class='line'>│   │   ├── loadModule.js.coffee
</span><span class='line'>│   │   ├── messageModule.js.coffee
</span><span class='line'>│   │   ├── socketModule.js.coffee
</span><span class='line'>│   │   └── userModule.js.coffee
</span><span class='line'>│   └── templates
</span><span class='line'>│       ├── message.jst.ejs
</span><span class='line'>│       ├── modal.jst.ejs
</span><span class='line'>│       └── user.jst.ejs
</span><span class='line'>├── application.js
</span><span class='line'>├── backboneApp.js
</span><span class='line'>└── backbone_app.js.coffee
</span></code></pre></td></tr></table></div></figure>

<p>
  <code>main.js.coffee</code> is where the app object is defined, while `launch.js.coffee` is called last, after all the files have loaded, to launch the Backbone.js application. Each module, which might contain models, collections and views, are stored within the modules folder. The module structure was modelled after <a href="http://tbranyen.github.com/backbone-boilerplate/">Backbone Boilerplate</a>.
</p>

<h2>JavaScript Templates and EJS</h2>
<p>
  To take full advantage of the asset pipeline it seems as if Sam Stephenson&#8217;s excellent <a href="https://github.com/sstephenson/ruby-ejs">EJS Gem</a> was the most hassle free approach for JavaScript templates. Both the &#8216;ejs&#8217; and &#8216;jst&#8217; extensions are require for the EJS gem to compile the template, and include it within a JavaScript file. Access to the template is done with the global <code>JST</code> object.
</p>

<h2>Application Architecture - Publish/Subscribe</h2>
<p>
  Before creating the application I decided to forgo the use of asynchronous module definition (AMD) and use a publish/subscribe (pub/sub) architecture (<a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#detailedobserver">see Addy Osmani&#8217;s description of Pub/Sub</a>). Specifically, each module is wrapped in an <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">immediately-invoked function expression</a>, and within each module functions can attach themselves to events (subscribe), or trigger events (publish). Using this approach the applcation&#8217;s only global variable is <code>app</code> which contains a copy of Backbone&#8217;s event object. 
</p>
<p>
  To reiterate none of the modules call methods from other modules, all communication occurs with pub/sub. This design pattern was a pleasure to use; adding new functionality often required simply subscribing to events! I found that my code stayed much cleaner than previous attemps with Backbone.js.
</p>

<h2>Module Architecture</h2>
<p>The application is comprised of two types of modules, those that contain Backbone.js code (messageModule, userModule), and one that contains the Socket.IO code (socketModule). If either the messageModule, or the userModule, require content from Socket.IO they subscribe to events that the socketModule trigger. Likewise, Socket.IO messages sent to the server are the result of the socketModule suscribing to events triggered by the messageModule and userModule.
</p>
<p>
  Below is an example module that contains skeleton code for an additional Backbone.js module. The ExampleModule class is used to glue all the Backbone.js objects together. In this case their is only one, the ExampleView, in Chatty&#8217;s MessageModule there are two distinct views instantiated within its MessageModule object. 
</p>
<figure class='code'><figcaption><span>Example Module</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">ExampleModel = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nv">ExampleCollection = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span>
</span><span class='line'>  <span class="nv">model: </span><span class="nx">ExampleModel</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># View for a single model</span>
</span><span class='line'><span class="nv">ExampleView = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span>
</span><span class='line'>  <span class="nv">render: </span><span class="nf">() -&gt;</span>
</span><span class='line'>    <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span> <span class="nx">app</span><span class="p">.</span><span class="nx">template</span> <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@$el</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># View for a collection of models</span>
</span><span class='line'><span class="nv">ExamplesView = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span>
</span><span class='line'>  <span class="nv">initialize: </span><span class="nf">() -&gt;</span>
</span><span class='line'>    <span class="vi">@collection = </span><span class="k">new</span> <span class="nx">ExampleCollection</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">@collection</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">@addExample</span><span class="p">,</span> <span class="err">@</span>
</span><span class='line'>    <span class="nx">@eventHandlers</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">eventHandlers: </span><span class="nf">() -&gt;</span>
</span><span class='line'>    <span class="c1"># Subscribe to the app-wide event &#39;new-example&#39;. When </span>
</span><span class='line'>    <span class="c1"># the event is called, the call-back function is provided</span>
</span><span class='line'>    <span class="c1"># with an example model, which is then added to the collection.</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;new-example&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">example</span><span class="p">)</span> <span class="o">=&gt;</span>
</span><span class='line'>      <span class="nx">@collection</span><span class="p">.</span><span class="nx">add</span> <span class="nx">example</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">addExample: </span><span class="nf">(example) -&gt;</span>
</span><span class='line'>    <span class="nv">exampleView = </span><span class="k">new</span> <span class="nx">ExampleView</span>
</span><span class='line'>      <span class="nv">model: </span><span class="nx">example</span>
</span><span class='line'>    <span class="nx">@$el</span><span class="p">.</span><span class="nx">append</span> <span class="nx">exampleView</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nx">ExampleModule</span>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">() -&gt;</span>
</span><span class='line'>    <span class="vi">@examplesView = </span><span class="k">new</span> <span class="nx">ExamplesView</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">new</span> <span class="nx">ExampleView</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>
<h2>Deploying Node.js and Rails App to Heroku</h2>
<h3>Deploying the Node.js server</h3>

<p>
  Heroku requires the following code to create the Socket.IO server and listen for connections (note that Heroku doesn&#8217;t support websockets):
<p>
<figure class='code'><figcaption><span>Socket.IO server</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">).</span><span class="nx">createServer</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;transports&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;xhr-polling&quot;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;polling duration&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;close timeout&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">io</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;log level&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">5001</span><span class="p">;</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>
<p>
  Unfortunately, Heroku&#8217;s documentation only contains fragments of the above code. The above code, along with deploying instructions, is posted across several pages: <a href="http://devcenter.heroku.com/articles/node-js">getting started with Node.js on Heroku/Cedar</a> and <a href="http://devcenter.heroku.com/articles/using-socket-io-with-node-js-on-heroku">using Socket.IO with Node.js on Heroku</a>. The `close timeout` option was added since the default 25 seconds made the chat app seem buggy (a user would log out but other users would seem them logged in for 25 seconds).
</p>

<h3>Deploying the Rails app</h3>
<p>
  Deploying a Rails application is relatively well documented, but I thought I&#8217;d provide a few additional tips.
</p>
<p>
  The URL for the production and development Socket.IO server differ. To accommodate this the Backbone.js app makes an Ajax request to the Rails app and gets the URL of the Socket.IO server along with a unique id for the current user. The Rails app can serve a different Socket.IO URL depending on whether it is currently in production or development.
</p>
<p>
  The other thing that might be new for nacent Rail&#8217;s developers is the inclusion of the <code>response.headers</code> code in the show method, this tells the browser to cache the Backbone.js app for 25,300 seconds.
</p>
<figure class='code'><figcaption><span>Controller associated with Backbone.js App</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BackboneAppController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">layout</span> <span class="s1">&#39;backboneApp&#39;</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="ss">:html</span><span class="p">,</span> <span class="ss">:json</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Cache-Control&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;public, max-age=25300&#39;</span> <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">user_info</span>
</span><span class='line'>    <span class="n">respond_with</span><span class="p">({</span>
</span><span class='line'>        <span class="s1">&#39;uuid&#39;</span> <span class="o">=&gt;</span> <span class="no">UUIDTools</span><span class="o">::</span><span class="no">UUID</span><span class="o">.</span><span class="n">random_create</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;socketURL&#39;</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="o">.</span><span class="n">get_socket_url</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">protected</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">get_socket_url</span>
</span><span class='line'>    <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span> <span class="p">?</span> <span class="s2">&quot;http://chatty-server.herokuapp.com/&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://0.0.0.0:5001&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>
<p>
  In order for Heroku to manage the asset pipeline your application must be <a href="http://devcenter.heroku.com/articles/rails3">deployed to Heroku Cedar&#8217;s stack</a>. Unfortunately the Cedar stack doesn&#8217;t include Varnish caching, requiring you to enable caching via <a href="http://devcenter.heroku.com/articles/memcache#deploying_to_heroku">memcache and the dalli gem</a>. I found that deploying a new version would not necessarily clear the cache and and I had to do it manually (connect to console: <code>heroku run console</code>):
</p>

<figure class='code'><figcaption><span>Clearing the cache</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">dc</span> <span class="o">=</span> <span class="no">Dalli</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;localhost:11211&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">dc</span><span class="o">.</span><span class="n">flush_all</span>
</span></code></pre></td></tr></table></div></figure>

<h2>Final Thoughts</h2>
<p>Relying entirely on pub/sub to communicate between modules worked really well in this application, but I wonder if it would scale to a larger application? I&#8217;d also be curious to know how other developers are combining Backbone apps with Rails, I suspect there are a number of ways to do it.</p>

<p>
<a class="github" href="https://github.com/liamks/Chatty"><span></span>Code on Github</a>
</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Liam Kaufman</span></span>

      








  


<time datetime="2012-02-25T00:00:00-05:00" pubdate data-updated="true">Feb 25<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  <a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>

  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo/" data-via="liamkaufman" data-counturl="http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/02/18/integrating-backbone-boilerplate-with-rails3/" title="Previous Post: Integrating Backbone Boilerplate with Rails 3">&laquo; Integrating Backbone Boilerplate with Rails 3</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/03/01/why-riak-and-nodejs-make-a-great-pair/" title="next Post: Why Riak and Node.js Make a Great Pair">Why Riak and Node.js Make a Great Pair &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  <div class='social'>

  <a id="twitter" href="https://twitter.com/liamkaufman"><span></span>@liamkaufman</a>
  <a id="github" href="https://github.com/liamks"><span></span>@liamks</a>
  <a id="linked-in" href="http://www.linkedin.com/pub/liam-kaufman/1b/7b4/2a4"><span></span>Liam Kaufman</a> 
</div>


  <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/09/common-javascript-errors/">Common JavaScript Errors</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/04/redis-and-relational-data/">Redis and Relational Data</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/21/adding-authentication-waiting-lists-and-sign-ups-to-and-express-app-using-drawbridge-and-redis/">Adding Authentication, Waiting Lists and Sign Ups to an Express App Using Drawbridge.js and Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/22/making-hacker-news-faster-two-approaches/">Making Hacker News Faster: Two Approaches</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/22/from-digg-to-reddit-to-hacker-news-whats-next/">From Digg to Reddit to Hacker News: What's Next?</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("liamkaufman", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <p>Follow <a href="http://twitter.com/liamkaufman">@liamkaufman</a></p>
  
</section>








</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Liam Kaufman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'liamkaufman';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo/';
        var disqus_url = 'http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





    

<script type="text/javascript">
      var disqus_shortname = 'liamkaufman';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo/';
        var disqus_url = 'http://liamkaufman.com/blog/2012/02/25/adding_real-time_to_rails_with_socket.IO_nodejs_and_backbonejs_with_demo/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
  </script>
</body>
</html>
